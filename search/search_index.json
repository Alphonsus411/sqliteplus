{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"SQLitePlus Enhanced","text":"<p>SQLitePlus Enhanced re\u00fane en un mismo paquete todo lo necesario para trabajar c\u00f3modamente con bases SQLite. Puedes montar una API moderna o limitarte a gestionar la base desde la consola, seg\u00fan lo que necesites en cada momento.</p>"},{"location":"#que-ofrece","title":"Qu\u00e9 ofrece","text":"<ul> <li>Operaciones asincr\u00f3nicas que cuidan el acceso concurrente a varias bases.</li> <li>Inicio de sesi\u00f3n con JWT usando un sencillo archivo JSON de usuarios.</li> <li>Compatibilidad con SQLCipher, sin complicaciones extra para quien no lo necesite.</li> <li>Copias y exportaciones guiadas para obtener CSVs o respaldos fechados con un comando.</li> <li>CLI <code>sqliteplus</code> con mensajes claros que acompa\u00f1an cada paso.</li> </ul> <p>Explora el men\u00fa lateral para seguir los pasos de instalaci\u00f3n, configuraci\u00f3n y ejemplos de uso paso a paso.</p>"},{"location":"api/","title":"API REST - SQLitePlus Enhanced","text":"<p>La API ofrece operaciones CRUD sobre m\u00faltiples bases SQLite protegidas por JWT.</p> <p>Swagger disponible en: <code>http://localhost:8000/docs</code></p>"},{"location":"api/#autenticacion","title":"Autenticaci\u00f3n","text":""},{"location":"api/#post-token","title":"<code>POST /token</code>","text":"<p>Genera un token JWT v\u00e1lido por una hora. Las credenciales se validan contra el archivo definido en <code>SQLITEPLUS_USERS_FILE</code>.</p> <p>Nota: la ruta se anuncia de forma relativa en el esquema OpenAPI, por lo que en despliegues con <code>root_path</code> o montajes aparecer\u00e1 como <code>&lt;prefijo&gt;/token</code>.</p> <ul> <li>Body (form-urlencoded)</li> <li><code>username</code></li> <li><code>password</code></li> <li>Respuestas</li> <li><code>200 OK</code>: <code>{ \"access_token\": \"&lt;jwt&gt;\", \"token_type\": \"bearer\" }</code></li> <li><code>400 Bad Request</code>: credenciales incorrectas o formulario inv\u00e1lido.</li> <li><code>500 Internal Server Error</code>: problemas al cargar el archivo de usuarios.</li> </ul>"},{"location":"api/#gestion-de-tablas","title":"Gesti\u00f3n de tablas","text":""},{"location":"api/#post-databasesdb_namecreate_table","title":"<code>POST /databases/{db_name}/create_table</code>","text":"<p>Crea una tabla si no existe. Los nombres de columnas se validan mediante <code>CreateTableSchema</code> y se escapan con comillas dobles.</p> <p>Normalizaci\u00f3n y validaciones de nombres</p> <ul> <li>Se eliminan espacios iniciales/finales de cada nombre antes de validar el patr\u00f3n de SQLite.</li> <li>La comparaci\u00f3n para detectar duplicados se hace con <code>casefold()</code>, por lo que <code>\"Nombre\"</code> y   <code>\" nombre \"</code> se consideran el mismo identificador.</li> <li> <p>Si despu\u00e9s de normalizar hay nombres repetidos, la API responde con <code>400 Bad Request</code>.</p> </li> <li> <p>Query: <code>table_name</code> (puede incluir espacios o guiones; la API lo escapar\u00e1 autom\u00e1ticamente)</p> </li> <li>Body:</li> </ul> <pre><code>{\n  \"columns\": {\n    \"id\": \"INTEGER PRIMARY KEY\",\n    \"msg\": \"TEXT\",\n    \"created_at\": \"TEXT\"\n  }\n}\n</code></pre> <ul> <li>Errores comunes</li> <li><code>400</code>: nombre de tabla inv\u00e1lido, columnas duplicadas o tipos vac\u00edos.</li> <li><code>500</code>: error inesperado en la base.</li> </ul>"},{"location":"api/#delete-databasesdb_namedrop_table","title":"<code>DELETE /databases/{db_name}/drop_table</code>","text":"<p>Elimina la tabla indicada. No falla si la tabla no existe.</p> <ul> <li>Query: <code>table_name</code> (obligatorio)</li> </ul> <pre><code>curl -X DELETE \"http://127.0.0.1:8000/databases/demo/drop_table?table_name=logs\" \\\n     -H \"Authorization: Bearer &lt;TOKEN&gt;\"\n</code></pre>"},{"location":"api/#operaciones-crud","title":"Operaciones CRUD","text":""},{"location":"api/#post-databasesdb_nameinsert","title":"<code>POST /databases/{db_name}/insert</code>","text":"<p>Inserta un registro en la tabla especificada. El payload puede llegar ya normalizado bajo la clave <code>values</code> o como un objeto plano (por compatibilidad con clientes sencillos); en este \u00faltimo caso, la API lo reestructura internamente a <code>{\"values\": { ... }}</code> antes de procesarlo.</p> <ul> <li>Query: <code>table_name</code> (obligatorio)</li> <li>Body (JSON): <code>{ \"values\": { \"columna\": \"valor\", ... } }</code> o <code>{ \"columna\": \"valor\", ... }</code></li> </ul> <pre><code>curl -X POST \"http://127.0.0.1:8000/databases/demo/insert?table_name=logs\" \\\n     -H \"Authorization: Bearer &lt;TOKEN&gt;\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\n           \"values\": {\n             \"msg\": \"Texto desde la API\"\n           }\n         }'\n</code></pre> <pre><code>curl -X POST \"http://127.0.0.1:8000/databases/demo/insert?table_name=logs\" \\\n     -H \"Authorization: Bearer &lt;TOKEN&gt;\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"msg\": \"Texto\"}'\n</code></pre> <ul> <li><code>404 Not Found</code>: la tabla indicada en <code>table_name</code> no existe en la base solicitada.</li> <li><code>409 Conflict</code>: violaci\u00f3n de restricciones (<code>UNIQUE</code>, <code>NOT NULL</code>, etc.).</li> </ul>"},{"location":"api/#get-databasesdb_namefetch","title":"<code>GET /databases/{db_name}/fetch</code>","text":"<p>Devuelve todas las filas de la tabla e incluye el nombre de cada columna en la respuesta para facilitar el consumo desde clientes gen\u00e9ricos. La clave <code>data</code> es un alias de <code>rows</code> para mantener compatibilidad con integraciones previas.</p> <ul> <li>Query: <code>table_name</code> (obligatorio)</li> </ul> <pre><code>curl -X GET \"http://127.0.0.1:8000/databases/demo/fetch?table_name=logs\" \\\n     -H \"Authorization: Bearer &lt;TOKEN&gt;\"\n</code></pre> <p>Nota: Los c\u00f3digos <code>404</code> pueden aparecer tanto en lecturas como en inserciones o borrados cuando la tabla indicada no existe.</p> <p>Respuesta de ejemplo:</p> <pre><code>{\n  \"columns\": [\"id\", \"msg\", \"created_at\", \"payload\"],\n  \"rows\": [\n    [1, \"Texto desde la API\", \"2025-05-30T10:00:00\", \"base64:AQID\"]\n  ],\n  \"data\": [\n    [1, \"Texto desde la API\", \"2025-05-30T10:00:00\", \"base64:AQID\"]\n  ]\n}\n</code></pre> <ul> <li>Los valores binarios se devuelven como cadenas con prefijo <code>base64:</code>.</li> <li>Los objetos <code>date</code>, <code>time</code> o <code>datetime</code> se serializan en formato ISO 8601.</li> </ul>"},{"location":"api/#reglas-generales","title":"Reglas generales","text":"<ul> <li>Todos los endpoints (excepto <code>token</code>) exigen <code>Authorization: Bearer &lt;token&gt;</code>.</li> <li>Los nombres de base de datos se normalizan y deben terminar en <code>.db</code> o se a\u00f1ade el sufijo.</li> <li>Los gestores asincr\u00f3nico y s\u00edncrono fuerzan <code>PRAGMA journal_mode=WAL</code> para mejorar la concurrencia.</li> </ul>"},{"location":"changelog/","title":"Resumen del historial de cambios","text":"<p>Esta p\u00e1gina resume los principales hitos publicados en el proyecto. Para revisar el detalle completo consulta el CHANGELOG en GitHub.</p>"},{"location":"changelog/#unreleased","title":"Unreleased","text":"<ul> <li>Sin entradas por ahora.</li> </ul>"},{"location":"changelog/#109-2025-11-14","title":"1.0.9 \u00b7 2025-11-14","text":"<ul> <li>CLI renovada con comandos de inspecci\u00f3n (<code>list-tables</code>, <code>describe-table</code>, <code>db-info</code>) y paneles FletPlus para explorar la base.</li> <li>Tablas y paneles enriquecidos con Rich, junto a m\u00e9todos s\u00edncronos que replican las operaciones de la CLI y mejoran la salida de <code>fetch</code>.</li> <li>Validaciones adicionales en nombres y rutas de bases/usuarios, reorganizaci\u00f3n de extras (<code>dev</code>, <code>redis</code>) y parches de seguridad en dependencias cr\u00edticas.</li> </ul>"},{"location":"changelog/#107-2025-06-01","title":"1.0.7 \u00b7 2025-06-01","text":"<ul> <li>Documentaci\u00f3n general actualizada para reflejar la configuraci\u00f3n mediante <code>SQLITEPLUS_USERS_FILE</code> y los nuevos flujos de trabajo.</li> <li>Gu\u00edas de MkDocs sincronizadas con las capacidades actuales de la librer\u00eda.</li> <li>Informaci\u00f3n operativa sobre recarga de usuarios, reinicios autom\u00e1ticos y soporte opcional para SQLCipher.</li> </ul>"},{"location":"changelog/#104-2025-05-22","title":"1.0.4 \u00b7 2025-05-22","text":"<ul> <li>Arquitectura modular dividida en <code>core/</code>, <code>api/</code>, <code>auth/</code> y <code>utils/</code>.</li> <li>CLI interactiva, API REST con Swagger y gestor as\u00edncrono basado en <code>aiosqlite</code>.</li> <li>Integraci\u00f3n de SQLCipher, soporte multi-base de datos, exportaciones CSV/backups y pipeline de publicaci\u00f3n en PyPI.</li> </ul>"},{"location":"changelog/#103-2025-03-03","title":"1.0.3 \u00b7 2025-03-03","text":"<ul> <li>Documentaci\u00f3n inicial y ampliaci\u00f3n del README.</li> <li>Primera versi\u00f3n de los endpoints en FastAPI.</li> </ul>"},{"location":"changelog/#102-2025-03-03","title":"1.0.2 \u00b7 2025-03-03","text":"<ul> <li>Correcciones en el servidor as\u00edncrono (actualmente en <code>sqliteplus/core/db.py</code>) para soportar m\u00faltiples clientes simult\u00e1neos.</li> <li>Nota: tras la refactorizaci\u00f3n de la versi\u00f3n 1.0.4 la funcionalidad de <code>server_async.py</code> se consolid\u00f3 en <code>sqliteplus/core/db.py</code> para mantener un \u00fanico gestor.</li> </ul>"},{"location":"changelog/#100-2025-03-02","title":"1.0.0 \u00b7 2025-03-02","text":"<ul> <li>Prototipo inicial de SQLitePlus basado en FastAPI.</li> </ul>"},{"location":"cli/","title":"CLI <code>sqliteplus</code>","text":"<p>El paquete instala el comando <code>sqliteplus</code>, pensado para quienes prefieren gestionar la base sin levantar la API. El comando principal acepta dos opciones globales:</p> <ul> <li><code>--cipher-key</code> (o la variable <code>SQLITE_DB_KEY</code>) para abrir bases cifradas.</li> <li><code>--db-path</code> para indicar qu\u00e9 archivo <code>.db</code> usar\u00e1n los subcomandos.</li> </ul>"},{"location":"cli/#inicializar-la-base","title":"Inicializar la base","text":"<pre><code>sqliteplus init-db\n</code></pre> <p>Si la base no existe se crea autom\u00e1ticamente y se anota la acci\u00f3n en la tabla <code>logs</code>. El mensaje de salida confirma la ruta final del archivo.</p>"},{"location":"cli/#ejecutar-consultas-de-escritura","title":"Ejecutar consultas de escritura","text":"<pre><code>sqliteplus execute INSERT INTO logs (action) VALUES ('Mensaje desde CLI')\n</code></pre> <p>El comando muestra un mensaje de \u00e9xito y, cuando hay una inserci\u00f3n, informa el \u00faltimo ID generado. Los errores de SQLite se convierten en mensajes claros de Click.</p>"},{"location":"cli/#consultar-informacion","title":"Consultar informaci\u00f3n","text":"<pre><code>sqliteplus fetch SELECT * FROM logs\n</code></pre> <p>Los resultados aparecen fila a fila. Si la consulta no devuelve datos el programa lo avisa para evitar confusiones.</p> <ul> <li>Usa <code>--summary</code> para generar una tabla adicional con m\u00ednimos, m\u00e1ximos y promedios de las columnas num\u00e9ricas.</li> <li>Con <code>--viewer</code> se abre un visor accesible construido con FletPlus; admite filtros en vivo, cambio de tema (<code>--viewer-theme</code>) y ajuste del tama\u00f1o del texto.</li> <li>Si necesitas paginar conjuntos grandes, combina <code>--viewer</code> con <code>--viewer-page-size</code> o <code>--viewer-virtual</code> para cargar filas bajo demanda.</li> <li>Cuando eliges <code>--output json</code>, cada valor de la consulta se normaliza antes de mostrarse: los BLOBs se codifican en Base64, los <code>Decimal</code> se convierten a n\u00fameros o cadenas y las fechas/horas se expresan en ISO 8601, evitando errores de serializaci\u00f3n.</li> </ul> <p>Para usar <code>--viewer</code> debes instalar el extra opcional <code>visual</code>: <code>pip install \"sqliteplus-enhanced[visual]\"</code>.</p>"},{"location":"cli/#comandos-y-flags-que-requieren-el-extra-visual","title":"Comandos y flags que requieren el extra <code>visual</code>","text":"<p>Los visores interactivos de FletPlus solo est\u00e1n disponibles cuando instalas el extra <code>visual</code>. Inst\u00e1lalo si necesitas alguno de los siguientes flujos:</p> <ul> <li><code>sqliteplus fetch --viewer</code>: habilita una cuadr\u00edcula interactiva donde tambi\u00e9n puedes combinar <code>--viewer-theme</code>, <code>--viewer-page-size</code> y <code>--viewer-virtual</code> para ajustar el aspecto y la paginaci\u00f3n.</li> <li><code>sqliteplus list-tables --viewer</code>: muestra un panel navegable para explorar tablas y vistas con filtros y ordenaci\u00f3n.</li> <li><code>sqliteplus visual-dashboard</code>: abre el panel completo de FletPlus y admite los flags <code>--theme</code>, <code>--accent-color</code> y <code>--max-rows</code> para personalizar el entorno.</li> </ul>"},{"location":"cli/#listar-tablas-disponibles","title":"Listar tablas disponibles","text":"<pre><code>sqliteplus list-tables\n</code></pre> <p>Muestra una tabla con todas las tablas de usuario y el n\u00famero de filas registradas. A\u00f1ade <code>--include-views</code> si tambi\u00e9n quieres ver las vistas definidas. Con <code>--viewer</code> obtienes un cat\u00e1logo visual donde puedes ordenar y navegar por los objetos con ayuda de la \u00faltima versi\u00f3n de FletPlus.</p>"},{"location":"cli/#describir-la-estructura-de-una-tabla","title":"Describir la estructura de una tabla","text":"<pre><code>sqliteplus describe-table logs\n</code></pre> <p>Obtendr\u00e1s un resumen con el n\u00famero de filas, columnas, \u00edndices y claves for\u00e1neas de la tabla seleccionada.</p>"},{"location":"cli/#ver-estadisticas-generales","title":"Ver estad\u00edsticas generales","text":"<pre><code>sqliteplus db-info\n</code></pre> <p>Imprime la ruta del archivo activo, su tama\u00f1o en disco y el total de tablas, vistas y filas.</p>"},{"location":"cli/#panel-visual-con-fletplus","title":"Panel visual con FletPlus","text":"<pre><code>sqliteplus visual-dashboard --theme dark --accent-color BLUE_200\n</code></pre> <p>Abre un panel enriquecido que aprovecha la nueva actualizaci\u00f3n de FletPlus. Puedes elegir el tema (<code>--theme</code>), personalizar el color primario (<code>--accent-color</code>) y navegar por vistas dedicadas a resumen, consultas, historial y ayudas de accesibilidad. Desde el propio panel es posible acceder a la paleta de comandos (Ctrl+K) o consultar los consejos incorporados.</p> <p>Este comando tambi\u00e9n requiere instalar el extra <code>visual</code> mediante <code>pip install \"sqliteplus-enhanced[visual]\"</code>.</p>"},{"location":"cli/#escenario-manual-validar-max_rows-en-visual-dashboard","title":"Escenario manual: validar <code>max_rows</code> en <code>visual-dashboard</code>","text":"<ol> <li>Ejecuta <code>sqliteplus init-db</code> y crea una tabla con al menos 1\u202f000 filas usando \u00fanicamente comandos compatibles con cualquier instalaci\u00f3n base:</li> </ol> <p><code>bash    sqliteplus execute \"CREATE TABLE IF NOT EXISTS demo (id INTEGER PRIMARY KEY, note TEXT)\"    sqliteplus execute \"WITH RECURSIVE counter(x) AS (SELECT 1 UNION ALL SELECT x + 1 FROM counter WHERE x &lt; 1000) INSERT INTO demo(note) SELECT printf('fila %d', x) FROM counter\"</code></p> <ol> <li>Abre el panel con <code>sqliteplus visual-dashboard --max-rows 25</code> y dir\u00edgete a la pesta\u00f1a de consultas.</li> <li>Lanza <code>SELECT * FROM demo</code> sin cl\u00e1usula <code>LIMIT</code>. El panel solo mostrar\u00e1 25 filas y el mensaje inferior indicar\u00e1 que la consulta se trunc\u00f3 por el l\u00edmite configurado.</li> <li>Repite la consulta a\u00f1adiendo <code>LIMIT 10</code> para comprobar que el mensaje cambia y ya no se advierte truncamiento.</li> </ol> <p>Si prefieres usar extensiones como <code>generate_series</code>, recuerda cargar expl\u00edcitamente la extensi\u00f3n antes de ejecutar los ejemplos (<code>SELECT load_extension('mod_spatialite');</code>, etc.). El tutorial incluye instrucciones que funcionan sin extensiones para que puedas copiar y pegar los comandos en la CLI est\u00e1ndar de inmediato.</p>"},{"location":"cli/#exportar-una-tabla-a-csv","title":"Exportar una tabla a CSV","text":"<pre><code>sqliteplus export-csv logs logs.csv\n</code></pre> <p>Genera un CSV con encabezados listo para compartir. Puedes utilizar nombres de tabla con espacios o guiones (<code>\"logs con espacios\"</code>, <code>\"logs-con-guion\"</code>), la herramienta se encarga de escaparlos sin perder seguridad. Si necesitas otra base diferente a la global, a\u00f1ade <code>--db-path /ruta/a/otra.db</code>.</p> <p>De forma predeterminada, <code>export-csv</code> evita sobrescribir archivos ya existentes para que no pierdas datos accidentalmente. Si realmente deseas reemplazar el archivo, pasa el flag <code>--overwrite</code> y el comando continuar\u00e1 sin detenerse.</p> <p>Nota: la utilidad <code>SQLiteReplication.export_to_csv</code> \u00fanicamente devuelve la ruta final; la CLI se encarga de mostrarla en un panel Rich para evitar mensajes duplicados cuando reutilices la funci\u00f3n desde tus propios scripts.</p>"},{"location":"cli/#exportar-resultados-de-una-consulta","title":"Exportar resultados de una consulta","text":"<pre><code>sqliteplus export-query --format json resultados.json \"SELECT * FROM logs ORDER BY created_at DESC\"\n</code></pre> <p>Permite ejecutar una consulta <code>SELECT</code> y guardar el resultado en un archivo JSON o CSV sin pasar por la API. Es \u00fatil para compartir subconjuntos filtrados o preparar datos para otras herramientas sin modificar la base.</p> <ul> <li><code>--format</code> controla el formato de salida (<code>json</code> por defecto o <code>csv</code>).</li> <li><code>--limit</code> restringe el n\u00famero de filas exportadas sin alterar la consulta original.</li> <li><code>--overwrite</code> habilita la sobrescritura del archivo de destino cuando ya existe.</li> </ul> <p>Cuando eliges <code>--format json</code>, los valores especiales se transforman autom\u00e1ticamente para garantizar que el archivo pueda serializarse sin errores: los BLOBs y <code>memoryview</code> se codifican en Base64 con el prefijo <code>base64:</code>, los <code>Decimal</code> se convierten a n\u00fameros de punto flotante (o cadenas si exceden el rango) y las fechas/horas se expresan en ISO 8601. Adem\u00e1s, si una columna carece de nombre o SQLite retorna una cadena vac\u00eda, el comando genera encabezados gen\u00e9ricos (<code>columna_1</code>, <code>columna_2</code>, etc.) para asegurar claves v\u00e1lidas en cada registro JSON.</p> <p>Si optas por CSV ocurre lo mismo: se respetan los nombres de columna provistos por la consulta, pero los huecos o celdas sin alias se sustituyen por esos identificadores autom\u00e1ticos, manteniendo la estructura tabular coherente.</p> <pre><code>sqliteplus export-query --format csv --limit 100 --overwrite resumen.csv \\\n  \"SELECT level, COUNT(*) AS eventos FROM logs GROUP BY level ORDER BY level\"\n</code></pre> <p>Cuando la consulta no devuelve nombres de columna o estos llegan vac\u00edos (por ejemplo, al usar <code>SELECT '' AS \"\"</code> o expresiones similares), la CLI crea los encabezados <code>columna_n</code> para mantener una estructura coherente en el archivo final.</p>"},{"location":"cli/#crear-copias-de-seguridad","title":"Crear copias de seguridad","text":"<pre><code>sqliteplus backup\n</code></pre> <p>Obtendr\u00e1s un respaldo fechado en la carpeta <code>backups/</code>. El comando indica el archivo final. Tambi\u00e9n puedes pasar <code>--db-path</code> para copiar una base concreta.</p> <p>De forma an\u00e1loga, <code>SQLiteReplication.backup_database</code> retorna la ubicaci\u00f3n creada sin imprimir mensajes directos, lo que garantiza que toda la salida visible provenga de la CLI y puedas reutilizar la funci\u00f3n en otros contextos.</p>"},{"location":"cli/#trabajar-con-sqlcipher","title":"Trabajar con SQLCipher","text":"<pre><code>sqliteplus --cipher-key \"$SQLITE_DB_KEY\" backup\n</code></pre> <p>Si la clave es incorrecta o el int\u00e9rprete no soporta SQLCipher, la CLI mostrar\u00e1 un error f\u00e1cil de entender para guiarte en la correcci\u00f3n.</p>"},{"location":"cli/#nuevo-aspecto-con-rich","title":"Nuevo aspecto con Rich","text":"<p>Gracias a la librer\u00eda Rich, todos los comandos muestran tablas, paneles y colores que facilitan la lectura, especialmente en pantallas oscuras o cuando necesitas compartir los resultados por terminal.</p>"},{"location":"configuracion/","title":"Configuraci\u00f3n avanzada","text":""},{"location":"configuracion/#variables-de-entorno-soportadas","title":"Variables de entorno soportadas","text":"Variable Descripci\u00f3n <code>HOME</code> Utilizada al expandir rutas con <code>~</code> en <code>SQLITEPLUS_USERS_FILE</code>. <code>PYTEST_CURRENT_TEST</code> Detectada autom\u00e1ticamente por pytest para reiniciar bases temporales. <code>SECRET_KEY</code> Clave obligatoria para firmar JWT. Se valida en tiempo de ejecuci\u00f3n. <code>SQLITEPLUS_FORCE_RESET</code> Fuerza la reinicializaci\u00f3n de las bases sin depender de <code>PYTEST_CURRENT_TEST</code>. Admite <code>1</code>, <code>true</code> o <code>on</code>. La secci\u00f3n \"Reinicializaci\u00f3n autom\u00e1tica en pruebas\" de <code>docs/uso_avanzado.md</code> detalla el flujo. <code>SQLITEPLUS_USERS_FILE</code> Ruta (admite <code>~</code>) del archivo JSON con usuarios y hashes <code>bcrypt</code>. Solo es obligatorio al exponer la API/autenticaci\u00f3n. <code>SQLITE_DB_KEY</code> Clave SQLCipher opcional. Si no existe, se omite el cifrado."},{"location":"configuracion/#directorios-de-trabajo","title":"Directorios de trabajo","text":"<ul> <li>Las bases asincr\u00f3nicas se almacenan en la carpeta <code>databases/</code> por defecto.</li> <li>Las copias de seguridad generadas por la CLI residen en <code>backups/</code>.</li> <li><code>SQLiteReplication</code> copia los ficheros <code>-wal</code> y <code>-shm</code> asociados para mantener la integridad.</li> </ul>"},{"location":"configuracion/#opciones-de-la-cli","title":"Opciones de la CLI","text":"<ul> <li><code>--cipher-key</code> / <code>SQLITE_DB_KEY</code>: permite usar SQLCipher en las operaciones sincr\u00f3nicas.</li> <li>Los subcomandos <code>export-csv</code> y <code>backup</code> aceptan rutas personalizadas conservando nombres seguros.</li> </ul>"},{"location":"configuracion/#autenticacion-externa","title":"Autenticaci\u00f3n externa","text":"<p>El archivo apuntado por <code>SQLITEPLUS_USERS_FILE</code> debe tener la estructura:</p> <pre><code>{\n  \"admin\": \"$2b$12$...\"\n}\n</code></pre> <p>Puedes generar nuevos hashes con el m\u00f3dulo <code>bcrypt</code> desde Python, tal como se muestra en la gu\u00eda de uso b\u00e1sico.</p>"},{"location":"endpoints/","title":"Endpoints REST","text":"<p>Resumen r\u00e1pido de los recursos disponibles. Todos requieren <code>Authorization: Bearer &lt;token&gt;</code> salvo la ruta de autenticaci\u00f3n <code>token</code> (que se publicar\u00e1 respetando el <code>root_path</code>).</p>"},{"location":"endpoints/#autenticacion","title":"Autenticaci\u00f3n","text":"<ul> <li><code>POST /token</code> \u2013 genera un JWT firmado con <code>SECRET_KEY</code>. Usa el fichero <code>SQLITEPLUS_USERS_FILE</code> y se   mostrar\u00e1 como <code>&lt;prefijo&gt;/token</code> cuando la app se monte bajo un prefijo.</li> </ul>"},{"location":"endpoints/#gestion-de-bases-y-tablas","title":"Gesti\u00f3n de bases y tablas","text":"<ul> <li><code>POST /databases/{db_name}/create_table</code> \u2013 valida columnas con Pydantic, escapa identificadores y requiere <code>table_name</code> como par\u00e1metro de consulta (por ejemplo, <code>/databases/db_demo/create_table?table_name=clientes</code>).</li> <li><code>DELETE /databases/{db_name}/drop_table</code> \u2013 elimina la tabla si existe y tambi\u00e9n exige <code>table_name</code> como query (ejemplo: <code>/databases/db_demo/drop_table?table_name=clientes</code>).</li> </ul>"},{"location":"endpoints/#operaciones-crud","title":"Operaciones CRUD","text":"<ul> <li><code>POST /databases/{db_name}/insert</code> \u2013 inserta filas usando placeholders <code>?</code>, requiere <code>table_name</code> como query y responde con <code>404</code> si la tabla no existe.</li> <li><code>GET /databases/{db_name}/fetch</code> \u2013 devuelve todas las filas de la tabla indicado en <code>table_name</code>; responde con <code>404</code> si la tabla no existe.</li> </ul> <p>Consulta <code>docs/api.md</code> para conocer los cuerpos de petici\u00f3n y respuestas detalladas.</p>"},{"location":"instalacion/","title":"Instalaci\u00f3n","text":""},{"location":"instalacion/#requisitos-previos","title":"Requisitos previos","text":"<ul> <li>Python 3.10 o superior.</li> <li>Una versi\u00f3n moderna de SQLite (el soporte para WAL viene incluido y el proyecto aplica <code>PRAGMA journal_mode=WAL</code> autom\u00e1ticamente).</li> <li>Opcional: Redis (la integraci\u00f3n de cach\u00e9 est\u00e1 en desarrollo; consulta el CHANGELOG para conocer el estado actual del extra <code>redis</code>).</li> </ul>"},{"location":"instalacion/#desde-el-repositorio","title":"Desde el repositorio","text":"<pre><code>python -m venv .venv\nsource .venv/bin/activate\npip install -e .\n</code></pre> <p>Si vas a ejecutar las pruebas, el lint o contribuir con cambios instala tambi\u00e9n las dependencias opcionales y, a continuaci\u00f3n, ejecuta la suite con Pytest:</p> <pre><code>pip install -e '.[dev]'\npytest -v\n</code></pre> <p>Nota: La integraci\u00f3n con Redis a\u00fan no est\u00e1 disponible en la aplicaci\u00f3n. El extra <code>redis</code> \u00fanicamente instala las dependencias preliminares y puede cambiar en futuras versiones. Revisa el CHANGELOG para seguir el progreso.</p> <p>Nota r\u00e1pida: No necesitas ninguna configuraci\u00f3n manual adicional: el c\u00f3digo fuerza <code>PRAGMA journal_mode=WAL</code> cada vez que abre una conexi\u00f3n (consulta <code>sqliteplus/core/db.py</code> y <code>sqliteplus/utils/sqliteplus_sync.py</code>).</p> <p>Si aun as\u00ed deseas preparar el entorno con las dependencias de Redis instala el extra:</p> <pre><code>pip install -e '.[redis]'\n</code></pre>"},{"location":"instalacion/#extra-visual","title":"Extra <code>visual</code>","text":"<p>La instalaci\u00f3n principal ya incluye Rich, as\u00ed que todas las tablas, paneles y mensajes de la CLI lucen correctamente sin pasos adicionales. El extra <code>visual</code> es opcional y a\u00f1ade \u00fanicamente las dependencias de los visores interactivos basados en FletPlus.</p> <p>Inst\u00e1lalo solo si planeas usar los subcomandos o flags que abren esos visores (<code>sqliteplus fetch --viewer</code>, <code>sqliteplus list-tables --viewer</code>, <code>sqliteplus visual-dashboard</code>, etc.). Puedes consultar la lista completa en docs/cli.md para comprobar r\u00e1pidamente si lo necesitas.</p> <pre><code>pip install -e '.[visual]'\n</code></pre> <p>Nota: Consulta docs/cli.md para revisar los comandos que requieren el extra <code>visual</code>.</p>"},{"location":"instalacion/#desde-pypi","title":"Desde PyPI","text":"<pre><code>pip install sqliteplus-enhanced\n</code></pre> <p>Nota: La integraci\u00f3n con Redis est\u00e1 pendiente; instalar <code>sqliteplus-enhanced[redis]</code> solo a\u00f1ade las dependencias necesarias para futuras versiones. Consulta el CHANGELOG para conocer el estado actualizado.</p> <p>Para incluir estas dependencias opcionales de Redis usa:</p> <pre><code>pip install 'sqliteplus-enhanced[redis]'\n</code></pre> <p>Para habilitar las capacidades visuales desde PyPI instala el extra correspondiente:</p> <pre><code>pip install \"sqliteplus-enhanced[visual]\"\n</code></pre> <p>Nota: En docs/cli.md encontrar\u00e1s los comandos que dependen del extra <code>visual</code>.</p> <p>Consejo: Las comillas simples evitan que shells como <code>zsh</code> intenten expandir los corchetes, lo que podr\u00eda generar errores al instalar los extras.</p> <p>La distribuci\u00f3n incluye el comando <code>sqliteplus</code> y el paquete <code>sqliteplus.main</code> listo para ejecutarse con Uvicorn.</p>"},{"location":"uso_avanzado/","title":"Casos de uso avanzados","text":""},{"location":"uso_avanzado/#reinicializacion-automatica-en-pruebas","title":"Reinicializaci\u00f3n autom\u00e1tica en pruebas","text":"<p><code>AsyncDatabaseManager</code> detecta la variable <code>PYTEST_CURRENT_TEST</code> y elimina autom\u00e1ticamente la base temporal antes de cada suite, evitando datos residuales entre ejecuciones. A partir de esta versi\u00f3n la comprobaci\u00f3n es perezosa: el gestor vuelve a leer <code>PYTEST_CURRENT_TEST</code> (y la variable <code>SQLITEPLUS_FORCE_RESET</code>) cada vez que necesita crear una conexi\u00f3n. De este modo puedes activar el modo limpieza incluso si el objeto global ya estaba instanciado o si quieres forzar el borrado desde la app FastAPI (por ejemplo, antes de lanzar un lote de pruebas de integraci\u00f3n). Si la variable se activa cuando ya existe una conexi\u00f3n viva en el mismo bucle, el gestor la cierra, elimina los ficheros <code>*.db</code>, <code>*.db-wal</code> y <code>*.db-shm</code> y vuelve a levantar una base limpia. Usa valores como <code>1</code>, <code>true</code> o <code>on</code> para activar <code>SQLITEPLUS_FORCE_RESET</code> y elimina la variable cuando dejes de necesitar el borrado autom\u00e1tico.</p>"},{"location":"uso_avanzado/#conexiones-por-bucle-de-eventos","title":"Conexiones por bucle de eventos","text":"<p>Cuando se reutiliza el mismo nombre de base en distintos bucles de eventos (por ejemplo, al usar <code>httpx.AsyncClient</code> en paralelo), el gestor cierra y recrea la conexi\u00f3n para ese bucle, evitando errores de \"conexi\u00f3n ligada a otro loop\".</p>"},{"location":"uso_avanzado/#aplicar-sqlcipher-solo-si-existe-clave","title":"Aplicar SQLCipher solo si existe clave","text":"<p>Si <code>SQLITE_DB_KEY</code> est\u00e1 vac\u00edo, la API trabaja sin cifrado. Al definir la variable se ejecuta <code>PRAGMA key</code> y se propagan los posibles errores de SQLCipher en los logs.</p>"},{"location":"uso_avanzado/#replicacion-y-exportaciones-automatizadas","title":"Replicaci\u00f3n y exportaciones automatizadas","text":"<p>El m\u00f3dulo <code>sqliteplus.utils.replication_sync.SQLiteReplication</code> permite:</p> <ul> <li><code>backup_database()</code> \u2013 genera copias fechadas y duplica ficheros WAL/SHM si existen.</li> <li><code>replicate_database(&lt;ruta&gt;)</code> \u2013 clona la base en otra ruta aplicando la misma clave SQLCipher.</li> <li><code>export_to_csv(&lt;tabla&gt;, &lt;archivo&gt;)</code> \u2013 exporta columnas y filas preservando el nombre de campos.</li> </ul> <p>A partir de esta versi\u00f3n, al instanciar <code>SQLiteReplication()</code> sin argumentos se crea una copia local en <code>./sqliteplus/databases/database.db</code>, exactamente igual que hace la CLI. Esto evita que los procesos automatizados modifiquen el paquete instalado y garantiza que cualquier replicaci\u00f3n o exportaci\u00f3n parta de un archivo sobre el que se puede escribir en el directorio de trabajo. Cuando el origen solicitado est\u00e1 dentro del paquete o se detecta que no es escribible, el m\u00f3dulo realiza una copia byte a byte en el directorio local (incluyendo los pares <code>-wal</code>/<code>-shm</code>). Si la base de datos original no existe se aborta la operaci\u00f3n con un mensaje claro en lugar de crear un archivo vac\u00edo.</p>"},{"location":"uso_avanzado/#actualizacion-caliente-de-usuarios","title":"Actualizaci\u00f3n caliente de usuarios","text":"<p><code>sqliteplus.auth.users.get_user_service()</code> mantiene una cach\u00e9 basada en la firma del archivo. Al modificar <code>SQLITEPLUS_USERS_FILE</code> se detecta el cambio autom\u00e1ticamente y se recarga la lista de usuarios sin reiniciar el proceso.</p>"},{"location":"uso_basico/","title":"Uso b\u00e1sico","text":""},{"location":"uso_basico/#1-configura-las-variables-de-entorno","title":"1. Configura las variables de entorno","text":"<pre><code>export SECRET_KEY=$(python -c \"import secrets; print(secrets.token_urlsafe(32))\")\nexport SQLITE_DB_KEY=$(python -c \"import secrets; print(secrets.token_hex(32))\")\nexport SQLITEPLUS_USERS_FILE=\"$(pwd)/users.json\"\n</code></pre> <p><code>SQLITEPLUS_USERS_FILE</code> solo es obligatorio para la API protegida con JWT. La CLI local puede trabajar sin ese archivo.</p> <p>Crea el archivo <code>users.json</code> con hashes <code>bcrypt</code>:</p> <pre><code>python - &lt;&lt;'PY'\nfrom sqliteplus._compat import ensure_bcrypt\nimport json, pathlib\n\nbcrypt = ensure_bcrypt()\npassword = \"admin\"\npath = pathlib.Path(\"users.json\")\npath.write_text(\n    json.dumps({\"admin\": bcrypt.hashpw(password.encode(), bcrypt.gensalt()).decode()})\n)\nPY\n</code></pre> <p>Alternativamente puedes generar hashes con el helper integrado, que delega en <code>ensure_bcrypt()</code> y evita tener que conocer si el backend nativo est\u00e1 disponible. Si no pasas la contrase\u00f1a como argumento, se solicitar\u00e1 de forma oculta con <code>getpass</code>:</p> <pre><code>python -m sqliteplus.auth.users hash admin\n# o bien:\npython -m sqliteplus.auth.users hash\n</code></pre> <p>Cuando ejecutes cualquiera de los ejemplos anteriores sin la dependencia compilada instalada, <code>ensure_bcrypt()</code> activar\u00e1 autom\u00e1ticamente el m\u00f3dulo <code>sqliteplus._compat.bcrypt</code>. Si prefieres trabajar siempre con el backend oficial instala el extra <code>security</code> (<code>pip install \"sqliteplus-enhanced[security]\"</code>).</p>"},{"location":"uso_basico/#2-arranca-la-api","title":"2. Arranca la API","text":"<pre><code>uvicorn sqliteplus.main:app --reload\n</code></pre>"},{"location":"uso_basico/#3-obten-un-token-jwt","title":"3. Obt\u00e9n un token JWT","text":"<pre><code>BASE_URL=${BASE_URL:-http://127.0.0.1:8000}\ncurl -X POST \"${BASE_URL%/}/token\" \\\n     -H \"Content-Type: application/x-www-form-urlencoded\" \\\n     -d \"username=admin&amp;password=admin\"\n</code></pre> <p>Si sirves la aplicaci\u00f3n detr\u00e1s de un <code>root_path</code> (por ejemplo <code>/api/sqlite</code>), define <code>BASE_URL</code> con dicho prefijo para que las rutas se resuelvan correctamente.</p> <p>La respuesta incluye <code>access_token</code> y <code>token_type</code>.</p>"},{"location":"uso_basico/#4-crea-una-tabla-en-la-base-demo","title":"4. Crea una tabla en la base <code>demo</code>","text":"<pre><code>curl -X POST \"http://127.0.0.1:8000/databases/demo/create_table?table_name=logs\" \\\n     -H \"Authorization: Bearer &lt;TOKEN&gt;\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"columns\": {\"id\": \"INTEGER PRIMARY KEY\", \"msg\": \"TEXT\", \"created_at\": \"TEXT\"}}'\n</code></pre>"},{"location":"uso_basico/#5-inserta-datos","title":"5. Inserta datos","text":"<pre><code>curl -X POST \"http://127.0.0.1:8000/databases/demo/insert?table_name=logs\" \\\n     -H \"Authorization: Bearer &lt;TOKEN&gt;\" \\\n     -H \"Content-Type: application/json\" \\\n     -d '{\"values\": {\"msg\": \"Hola desde SQLitePlus\"}}'\n</code></pre>"},{"location":"uso_basico/#6-consulta-los-registros","title":"6. Consulta los registros","text":"<pre><code>curl -X GET \"http://127.0.0.1:8000/databases/demo/fetch?table_name=logs\" \\\n     -H \"Authorization: Bearer &lt;TOKEN&gt;\"\n</code></pre> <p>Recibir\u00e1s todas las filas de la tabla en formato JSON. El listado aparece bajo las claves <code>rows</code> y <code>data</code> (esta \u00faltima es un alias para compatibilidad con clientes antiguos).</p>"},{"location":"docs/","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"docs/#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"docs/#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"}]}